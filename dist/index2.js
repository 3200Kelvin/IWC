import{i as T,a as v}from"./index.js";import"./index3.js";const _={colors:{tl:"#1f4287",tr:"#4c68a9",bl:"#0c2b62",br:"#7c89cd"},canvasId:"mesh-canvas",dots:[[-1,-1],[-1,1],[.3,-.4],[1,1]],moving:[{index:2,revert:!1}],target:[[-1,.5]]};let m,g,L=32,b=_.colors,F={right:0,left:0,top:0,bottom:0};function I(t){let e=new XMLHttpRequest;return e.open("GET",t,!1),e.overrideMimeType("text/plain; charset=x-user-defined"),e.send(null),e.status!=200&&e.status!=0?null:e.responseText}function y(t){let e=document.getElementById(t);if(!e)throw Error("element '"+t+"' not found");return e.hasAttribute("src")?I(e.src):e.text}function d(t,e,n,r){this.parent=t,this.which=e,this.src=n,this.dst=r,this.s2=[],this.w=[]}function U(t,e){let n=t.length,r=t[0].length,a=e[0].length;for(let s=0;s<r-1;s++){let o=s,i=o+1,h=Math.abs(t[o][s]),f=o;for(let l=o+1;l<n;l++){let u=Math.abs(t[l][s]);h<u&&(h=u,f=l)}if(f!=o){let l=t[o];t[o]=t[f],t[f]=l;let u=e[o];e[o]=e[f],e[f]=u}for(let l=i;l<n;l++){let u=t[o][s],x=t[l][s];for(let p=s;p<r;p++)t[l][p]=u*t[l][p]-x*t[o][p];for(let p=0;p<a;p++)e[l][p]=u*e[l][p]-x*e[o][p]}}for(let s=n-1;s>=0;s--){for(let o=n-1;o>s;o--){let i=t[s][o];t[s][o]=0;for(let h=0;h<a;h++)e[s][h]-=i*e[o][h]}for(let o=0;o<a;o++)e[s][o]/=t[s][s];t[s][s]=1}return e}function w(t=[],e=[],n=0){this.npoints=n,this.src=t,this.dst=e,this.src.map(r=>typeof r[0]!="number"||typeof r[1]!="number"?[0,0]:r),this.dst.map(r=>typeof r[0]!="number"||typeof r[1]!="number"?[0,0]:r),this.warps=[new d(this,0,this.src,this.dst),new d(this,1,this.dst,this.src)]}function c(t,e,n,r){this.warp=t,this.id=n,this.canvas=e,e.setAttribute("tabIndex",t.which+1),this.ctx=e.getContext("webgl",{preserveDrawingBuffer:!0}),this.isClone=r,this.errors=null,this.texture=null,this.position_buffer=null,this.texcoord_buffer=null,this.index_buffer=null,this.num_indices=null,this.warp_program=null,this.drag=null,this.radius=10,this.setup()}function A(t,e){let n=[];for(let r=0;r<t.length;r++){let a=t[r];for(let s=0;s<a.length;s++)n.push(a[s])}return n}d.prototype=new Object,d.prototype.npoints=function(){return this.parent.npoints},d.prototype.get_src=function(){let t=this.src.slice(0,this.npoints());for(let e=0;e<t.length;e++)t[e]=t[e].slice();return t},d.prototype.get_dst=function(){let t=this.dst.slice(0,this.npoints());for(let e=0;e<t.length;e++)t[e]=t[e].slice();return t},d.prototype.distance_squared=function(t,e,n){if(n){let r=[];for(let s=0;s<t.length;s++){let o=[];for(let i=0;i<t.length;i++)o.push(t[s][0]*t[i][0]+t[s][1]*t[i][1]);r.push(o)}let a=[];for(let s=0;s<t.length;s++){let o=[];for(let i=0;i<t.length;i++)o.push(r[s][s]+r[i][i]-2*r[s][i]);a.push(o)}return a}{let r=[];for(let i=0;i<t.length;i++){let h=[];for(let f=0;f<e.length;f++)h.push(t[i][0]*e[f][0]+t[i][1]*e[f][1]);r.push(h)}let a=[];for(let i=0;i<t.length;i++)a.push(t[i][0]*t[i][0]+t[i][1]*t[i][1]);let s=[];for(let i=0;i<e.length;i++)s.push(e[i][0]*e[i][0]+e[i][1]*e[i][1]);let o=[];for(let i=0;i<t.length;i++){let h=[];for(let f=0;f<e.length;f++)h.push(a[i]+s[f]-2*r[i][f]);o.push(h)}return o}},d.prototype.rbf=function(t,e,n){let r=this.distance_squared(t,e,n);if(n){let s=r[0][0];for(let i=0;i<r.length;i++)for(let h=0;h<r[i].length;h++)s<r[i][h]&&(s=r[i][h]);let o=[];for(let i=0;i<r.length;i++){let h=[];for(let f=0;f<r[i].length;f++)h.push(i==f?s:r[i][f]);o.push(h)}for(let i=0;i<o[0].length;i++){let h=o[0][i];for(let f=1;f<o.length;f++)h>o[f][i]&&(h=o[f][i]);this.s2[i]=h}}let a=[];for(let s=0;s<r.length;s++){let o=[];for(let i=0;i<r[s].length;i++)o.push(Math.sqrt(r[s][i]+this.s2[i]));a.push(o)}return a},d.prototype.update=function(){if(this.npoints()<4)return;let t=this.get_src(),e=this.get_dst(),n=U(this.rbf(t,t,!0),e);for(let r=0;r<n.length;r++)this.w[r]=n[r]},d.prototype.warp=function(t){if(this.npoints()<4)return t.slice();let e=this.rbf(t,this.get_src()),n=[];for(let r=0;r<e.length;r++){let a=[];for(let s=0;s<2;s++){let o=0;for(let i=0;i<e[r].length;i++)o+=e[r][i]*this.w[i][s];a.push(o)}n.push(a)}return n},w.prototype=new Object,w.prototype.update=function(){for(let t=0;t<this.warps.length;t++)this.warps[t].update()},w.prototype.add=function(t,e,n,r,a){if(a){let s=t;t=n,n=s;let o=e;e=r,r=o}this.src[this.npoints]=[t,e],this.dst[this.npoints]=[n,r],this.npoints++,this.update()},w.prototype.add_pair=function(t,e,n){let r=t?1:0,a=this.warps[r].warp([[e,n]])[0],s=a[0],o=a[1];this.add(e,n,s,o,t)},c.prototype.check_error=function(){let t=this.ctx;this.errors==null&&(this.errors={},this.errors[t.INVALID_ENUM]="invalid enum",this.errors[t.INVALID_VALUE]="invalid value",this.errors[t.INVALID_OPERATION]="invalid operation",this.errors[t.OUT_OF_MEMORY]="out of memory");for(let e=0;e<10;e++){let n=t.getError();if(n==0)return;throw Error(this.errors[n])}},c.prototype.shader=function(t,e,n){let r=this.ctx,a=r.createShader(e);if(r.shaderSource(a,n),r.compileShader(a),!r.getShaderParameter(a,r.COMPILE_STATUS))throw Error(t+": "+r.getShaderInfoLog(a));return a},c.prototype.program=function(t,e,n){let r=this.ctx,a=y(e),s=y(n),o=this.shader(t+".vertex",r.VERTEX_SHADER,a),i=this.shader(t+".fragment",r.FRAGMENT_SHADER,s),h=r.createProgram();if(r.attachShader(h,o),r.attachShader(h,i),r.linkProgram(h),!r.getProgramParameter(h,r.LINK_STATUS))throw new Error(r.getProgramInfoLog(h));return this.check_error(),h},c.prototype.setup_programs=function(){this.warp_program=this.program("warp","warp_vertex","warp_fragment"),this.point_program=this.program("points","point_vertex","point_fragment")},c.prototype.setup_buffers=function(){let t=this.ctx,e=new Float32Array([-1,-1,1,-1,1,1,-1,1]);this.position_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.position_buffer),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW);let n=new Float32Array([0,0,1,0,1,1,0,1]);this.texcoord_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoord_buffer),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),this.points_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.points_buffer),t.bufferData(t.ARRAY_BUFFER,2*L*4,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.indices=new Uint16Array([0,1,2,2,3,0]),this.num_indices=this.indices.length,this.index_buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.check_error()},c.prototype.set_uniform=function(t,e,n,r,a){let s=this.ctx,o=s.getUniformLocation(t,e);if(r==0)n.call(s,o,a);else{if(r!=1)throw new Error("invalid type");n.call(s,o,new Float32Array(a))}},c.prototype.draw=function(){let t=this.ctx;if(t.clearColor(.5,.5,1,1),t.clear(t.COLOR_BUFFER_BIT),this.warp.npoints()>=4){t.useProgram(this.warp_program),this.set_uniform(this.warp_program,"u_color3",t.uniform1i,0,b.tl.replace("#","0x")),this.set_uniform(this.warp_program,"u_color4",t.uniform1i,0,b.tr.replace("#","0x")),this.set_uniform(this.warp_program,"u_color2",t.uniform1i,0,b.br.replace("#","0x")),this.set_uniform(this.warp_program,"u_color1",t.uniform1i,0,b.bl.replace("#","0x")),this.set_uniform(this.warp_program,"tex",t.uniform1i,0,0),this.set_uniform(this.warp_program,"warp",t.uniform1i,0,this.warp.which),this.set_uniform(this.warp_program,"npoints",t.uniform1i,0,this.warp.npoints()),this.set_uniform(this.warp_program,"points",t.uniform2fv,1,A(this.warp.src)),this.set_uniform(this.warp_program,"s2",t.uniform1fv,1,this.warp.s2),this.set_uniform(this.warp_program,"w",t.uniform2fv,1,A(this.warp.w)),t.activeTexture(t.TEXTURE0);let e=t.getAttribLocation(this.warp_program,"a_Position"),n=t.getAttribLocation(this.warp_program,"a_TexCoord");t.enableVertexAttribArray(e),t.bindBuffer(t.ARRAY_BUFFER,this.position_buffer),t.vertexAttribPointer(e,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n),t.bindBuffer(t.ARRAY_BUFFER,this.texcoord_buffer),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.index_buffer),t.drawElements(t.TRIANGLES,this.num_indices,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.disableVertexAttribArray(e),t.disableVertexAttribArray(n),t.useProgram(null)}if(this.warp.npoints()>0&&!this.isClone){t.useProgram(this.point_program),this.set_uniform(this.point_program,"radius",t.uniform1f,0,this.radius),this.set_uniform(this.point_program,"color",t.uniform3fv,0,[0,0,0]);let e=t.getAttribLocation(this.point_program,"a_Position"),n=this.warp.get_src();t.enableVertexAttribArray(e),t.bindBuffer(t.ARRAY_BUFFER,this.points_buffer),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(A(n))),t.vertexAttribPointer(e,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.disableVertexAttribArray(e),t.useProgram(null)}t.flush(),this.check_error()},c.prototype.mouse_move=function(t){let e=F,n=e.right-e.left,r=e.bottom-e.top,a=(t.clientX-e.left)/n*2-1,s=(e.bottom-t.clientY)/r*2-1;this.moving.forEach((o,i)=>{this.drag[i][0];const h=this.drag[i][1],f=this.drag[i][2];let l=this.drag[i][3]-h+(o.revert?-a:a),u=this.drag[i][4]-f+(o.revert?-s:s);o.coeff&&(l*=o.coeff,u*=o.coeff),o.add&&o.add.vert&&(u+=o.add.vert),o.add&&o.add.hor&&(l+=o.add.hor),this.target[i]=[l,u]})},c.prototype.setup=function(){this.setup_programs(),this.setup_buffers(),document.onmousemove=this.mouse_move.bind(this)},c.prototype.update_position=function(){this.moving.forEach((t,e)=>{const n=[(this.target[e][0]-this.warp.src[t.index][0])/80,(this.target[e][1]-this.warp.src[t.index][1])/80],r=Math.abs(n[0])+Math.abs(n[1]);r===1/0||r===-1/0||r===NaN||r>.001&&(E(),this.warp.src[t.index][0]+=n[0],this.warp.src[t.index][1]+=n[1],m.update())})};let R=!1;function E(){R=!0}function B(){g.update_position(),R&&(g.draw(),R=!1),requestAnimationFrame(B)}function S(){const t=document.getElementById(_.canvasId);if(!t)throw Error("No canvas");t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight,new ResizeObserver(([n])=>{const{right:r,left:a,top:s,bottom:o}=n.contentRect;F={right:r,left:a,top:s,bottom:o},E()}).observe(t),m=new w,g=new c(m.warps[1],document.getElementById(_.canvasId),_.canvasId);for(let n=0;n<_.dots.length;n++){let r=_.dots[n][0],a=_.dots[n][1];m.add_pair(0,r,a)}m.update(),g.moving=_.moving,g.target=_.target,g.drag=g.moving.map((n,r)=>[n.index,...g.warp.src[n.index],...g.warp.src[n.index]]),E(),B()}const Y=()=>{if(!(T||v()))try{S();const t=document.querySelector(".page-bg__image--gradient");t.style.opacity=0}catch(t){console.warn(t)}};export{Y as useGradient};
